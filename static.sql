DROP TABLE IF EXISTS `g06`.`lap`;
DROP TABLE IF EXISTS `g06`.`race_drivers`;
DROP TABLE IF EXISTS `g06`.`race`;
DROP TABLE IF EXISTS `g06`.`kart`;
DROP TABLE IF EXISTS `g06`.`kart_model`;
DROP TABLE IF EXISTS `g06`.`client`;
DROP TABLE IF EXISTS `g06`.`track`;

-- MySQL Script generated by MySQL Workbench
-- Tue Jan 19 00:37:40 2021
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema g06
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema g06
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `g06` DEFAULT CHARACTER SET utf8 ;
USE `g06` ;

-- -----------------------------------------------------
-- Table `g06`.`kart_model`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `g06`.`kart_model` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `model` VARCHAR(45) NOT NULL,
  `power` DOUBLE NOT NULL,
  `number_of_seats` INT NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC) )
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `g06`.`kart`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `g06`.`kart` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `kart_number` INT NOT NULL,
  `kart_model_id` INT NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC) ,
  UNIQUE INDEX `kart_number_UNIQUE` (`kart_number` ASC) ,
  INDEX `kart_mdel_id_idx` (`kart_model_id` ASC) ,
  CONSTRAINT `kart_mdel_id`
    FOREIGN KEY (`kart_model_id`)
    REFERENCES `g06`.`kart_model` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `g06`.`client`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `g06`.`client` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  `email` VARCHAR(45) NOT NULL,
  `client_number` VARCHAR(45) NOT NULL,
  `sex` VARCHAR(1) NOT NULL,
  `user_id` INT NULL COMMENT 'Django user key',
  `phone_number` VARCHAR(45) NULL DEFAULT 0,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC) ,
  UNIQUE INDEX `user_id_UNIQUE` (`user_id` ASC) ,
  UNIQUE INDEX `email_UNIQUE` (`email` ASC) ,
  UNIQUE INDEX `clientcol_UNIQUE` (`phone_number` ASC) )
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `g06`.`track`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `g06`.`track` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `shape` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC) )
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `g06`.`race`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `g06`.`race` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `date` DATE NOT NULL,
  `number` INT NOT NULL,
  `finished` TINYINT NOT NULL DEFAULT 0,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC) )
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `g06`.`race_drivers`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `g06`.`race_drivers` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `race_id` INT NOT NULL,
  `kart_id` INT NOT NULL,
  `client_id` INT NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC) ,
  CONSTRAINT `race_id`
    FOREIGN KEY (`race_id`)
    REFERENCES `g06`.`race` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `kart_id`
    FOREIGN KEY (`kart_id`)
    REFERENCES `g06`.`kart` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `client_id`
    FOREIGN KEY (`client_id`)
    REFERENCES `g06`.`client` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `g06`.`lap`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `g06`.`lap` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `start_time` INT NOT NULL COMMENT 'In milliseconds',
  `end_time` INT NULL COMMENT 'In milliseconds',
  `track_id` INT NOT NULL,
  `race_drivers_id` INT NOT NULL,
  `time` INT NULL COMMENT 'In milliseconds',
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC),
  CONSTRAINT `track_id`
    FOREIGN KEY (`track_id`)
    REFERENCES `g06`.`track` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `race_drivers_id`
    FOREIGN KEY (`race_drivers_id`)
    REFERENCES `g06`.`race_drivers` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;


create trigger sub_time before INSERT on lap for each row set new.time=new.end_time-new.start_time;

DROP PROCEDURE IF EXISTS clear_race;
DELIMITER //
CREATE PROCEDURE clear_race(IN clear_race_id INT)
BEGIN
DELETE FROM lap WHERE id IN (SELECT x.id from (select l.id from lap l inner join race_drivers rd on (l.race_drivers_id=rd.id) where rd.race_id=clear_race_id)x) AND end_time IS NULL;
END //
DELIMITER ;

DROP PROCEDURE IF EXISTS new_race;
DELIMITER //
CREATE PROCEDURE new_race()
BEGIN
DECLARE last_number INT DEFAULT 0;
SELECT number INTO last_number from race r where r.date=CURDATE() order by number desc limit 1;
IF last_number > 0 THEN
INSERT INTO race(date, number) VALUES (CURDATE(), last_number+1);
ELSE
INSERT INTO race(date,number) VALUES (CURDATE(), 1);
END IF;
END //
DELIMITER ;


INSERT INTO `client` (`id`, `name`, `email`, `client_number`, `sex`) VALUES 
('1', 'Random Names', 'Random@Names.pl', '946930886', 'F'),
('2', 'Murray Copeland', 'Murray@Copeland.pl', '814636916', 'F'),
('3', 'Russell Donnelly', 'Russell@Donnelly.pl', '524238335', 'F'),
('4', 'Duane Woodward', 'Duane@Woodward.pl', '749760493', 'M'),
('5', 'Jessica Estes', 'Jessica@Estes.pl', '289641422', 'F'),
('6', 'Ariya Carlson', 'Ariya@Carlson.pl', '450490028', 'M'),
('7', 'Amal Ray', 'Amal@Ray.pl', '202520060', 'M'),
('8', 'Mehdi Goff', 'Mehdi@Goff.pl', '1067513927', 'F'),
('9', 'Suzannah Salinas', 'Suzannah@Salinas.pl', '640383427', 'M'),
('10', 'Rizwan Lister', 'Rizwan@Lister.pl', '403455737', 'M'),
('11', 'Cordelia Lozano', 'Cordelia@Lozano.pl', '621595368', 'F'),
('12', 'Esha Ramos', 'Esha@Ramos.pl', '826956430', 'F'),
('13', 'Javier Anthony', 'Javier@Anthony.pl', '961021530', 'M'),
('14', 'Rosina Dorsey', 'Rosina@Dorsey.pl', '333665123', 'M'),
('15', 'Ellis Bannister', 'Ellis@Bannister.pl', '568703135', 'F'),
('16', 'Huxley Choi', 'Huxley@Choi.pl', '901979803', 'F'),
('17', 'Bevan Strong', 'Bevan@Strong.pl', '735723058', 'M'),
('18', 'Keely Clegg', 'Keely@Clegg.pl', '225898168', 'F'),
('19', 'Billie-Jo Maldonado', 'Billie-Jo@Maldonado.pl', '189018458', 'F'),
('20', 'Tyler Britton', 'Tyler@Britton.pl', '756478043', 'F'),
('21', 'Martin Callaghan', 'Martin@Callaghan.pl', '753377374', 'F'),
('22', 'Elsa Stewart', 'Elsa@Stewart.pl', '1014544920', 'F'),
('23', 'Samirah Glass', 'Samirah@Glass.pl', '856898537', 'M'),
('24', 'David Lindsey', 'David@Lindsey.pl', '1073594325', 'M'),
('25', 'Danniella Dunne', 'Danniella@Dunne.pl', '138664372', 'F'),
('26', 'Eren Miranda', 'Eren@Miranda.pl', '284803526', 'F'),
('27', 'Abdullahi Villegas', 'Abdullahi@Villegas.pl', '524268981', 'F'),
('28', 'Marwan Leal', 'Marwan@Leal.pl', '849241873', 'M'),
('29', 'Vinnie Garner', 'Vinnie@Garner.pl', '142999170', 'M'),
('30', 'Karl Dowling', 'Karl@Dowling.pl', '235497281', 'M'),
('31', 'Nabiha Valencia', 'Nabiha@Valencia.pl', '184420927', 'F'),
('32', 'Tabitha Talley', 'Tabitha@Talley.pl', '927336328', 'M'),
('33', 'Alexis Bellamy', 'Alexis@Bellamy.pl', '259126506', 'M'),
('34', 'Isla-Mae Hogg', 'Isla-Mae@Hogg.pl', '732621730', 'M'),
('35', 'Iram Pennington', 'Iram@Pennington.pl', '533925858', 'F'),
('36', 'Caiden Thorne', 'Caiden@Thorne.pl', '184353895', 'M'),
('37', 'Tyrique Ponce', 'Tyrique@Ponce.pl', '101100547', 'M'),
('38', 'Freyja Houston', 'Freyja@Houston.pl', '648233368', 'M'),
('39', 'Abi Huber', 'Abi@Huber.pl', '685990365', 'M'),
('40', 'Jorgie Barber', 'Jorgie@Barber.pl', '860313750', 'F'),
('41', 'Libbie Ortega', 'Libbie@Ortega.pl', '456426808', 'F'),
('42', 'Jamaal Kaufman', 'Jamaal@Kaufman.pl', '989947179', 'M'),
('43', 'Roma Delacruz', 'Roma@Delacruz.pl', '809393584', 'M'),
('44', 'Coby Reyna', 'Coby@Reyna.pl', '1018502652', 'F'),
('45', 'Melvin Harrell', 'Melvin@Harrell.pl', '574612400', 'M'),
('46', 'Sachin Fry', 'Sachin@Fry.pl', '364095061', 'M'),
('47', 'Tony Vega', 'Tony@Vega.pl', '943993369', 'M'),
('48', 'Paula Lester', 'Paula@Lester.pl', '1084210013', 'F'),
('49', 'Donovan Gutierrez', 'Donovan@Gutierrez.pl', '849698587', 'M'),
('50', 'Zayd Mckee', 'Zayd@Mckee.pl', '1056297540', 'M'),
('51', 'Anas Wardle', 'Anas@Wardle.pl', '563480570', 'F'),
('52', 'Chyna Cairns', 'Chyna@Cairns.pl', '1075960379', 'M'),
('53', 'Mahir Bradley', 'Mahir@Bradley.pl', '992066602', 'F'),
('54', 'Ismaeel Morse', 'Ismaeel@Morse.pl', '1027612902', 'F'),
('55', 'Anniyah Hanna', 'Anniyah@Hanna.pl', '703570492', 'F'),
('56', 'Tasnim Michael', 'Tasnim@Michael.pl', '760260756', 'M'),
('57', 'Anish Moody', 'Anish@Moody.pl', '585560280', 'F'),
('58', 'Ivo Espinoza', 'Ivo@Espinoza.pl', '693209441', 'M'),
('59', 'Eliza Vang', 'Eliza@Vang.pl', '994429689', 'F'),
('60', 'Demi-Leigh Beck', 'Demi-Leigh@Beck.pl', '1047346620', 'M'),
('61', 'Etta Chang', 'Etta@Chang.pl', '370744729', 'M'),
('62', 'Leena Larsen', 'Leena@Larsen.pl', '733108118', 'F'),
('63', 'Tyra Strickland', 'Tyra@Strickland.pl', '107905773', 'F'),
('64', 'June Velez', 'June@Velez.pl', '922890675', 'F'),
('65', 'Hughie Millar', 'Hughie@Millar.pl', '891698927', 'F'),
('66', 'Angelo Legge', 'Angelo@Legge.pl', '598777856', 'F'),
('67', 'Ocean Boyer', 'Ocean@Boyer.pl', '624872353', 'F'),
('68', 'Wayne Long', 'Wayne@Long.pl', '672276966', 'M'),
('69', 'Subhan Lucero', 'Subhan@Lucero.pl', '803964684', 'M'),
('70', 'Jokubas Oconnell', 'Jokubas@Oconnell.pl', '700028625', 'F'),
('71', 'Kelis Marks', 'Kelis@Marks.pl', '140332873', 'M'),
('72', 'Tiya Evans', 'Tiya@Evans.pl', '220048830', 'M'),
('73', 'Rhian Webb', 'Rhian@Webb.pl', '615530019', 'F'),
('74', 'Huseyin Romero', 'Huseyin@Romero.pl', '673363369', 'M'),
('75', 'Samad Brennan', 'Samad@Brennan.pl', '177486717', 'M'),
('76', 'Muhamed Lugo', 'Muhamed@Lugo.pl', '731518150', 'M'),
('77', 'Bobbi Peterson', 'Bobbi@Peterson.pl', '389700723', 'M'),
('78', 'Shantelle Rosario', 'Shantelle@Rosario.pl', '268002245', 'M'),
('79', 'Anjali Hutchings', 'Anjali@Hutchings.pl', '539493451', 'M'),
('80', 'Cecil Gomez', 'Cecil@Gomez.pl', '860243556', 'F'),
('81', 'Fraya Childs', 'Fraya@Childs.pl', '722597489', 'F'),
('82', 'Keeleigh Henson', 'Keeleigh@Henson.pl', '438888228', 'M'),
('83', 'Miller Mcghee', 'Miller@Mcghee.pl', '538792350', 'F'),
('84', 'Rhia Rosales', 'Rhia@Rosales.pl', '369441500', 'F'),
('85', 'Damian Olsen', 'Damian@Olsen.pl', '216087764', 'M'),
('86', 'Rhyley Pike', 'Rhyley@Pike.pl', '255324914', 'M'),
('87', 'Eilish Lovell', 'Eilish@Lovell.pl', '1082275857', 'F'),
('88', 'Oisin Gillespie', 'Oisin@Gillespie.pl', '487346491', 'F'),
('89', 'Zane Novak', 'Zane@Novak.pl', '941148365', 'F'),
('90', 'Waleed Mcfarlane', 'Waleed@Mcfarlane.pl', '860281937', 'F'),
('91', 'Abbi Burke', 'Abbi@Burke.pl', '286452552', 'M'),
('92', 'Yassin Kramer', 'Yassin@Kramer.pl', '1071899228', 'F'),
('93', 'Evangeline Miller', 'Evangeline@Miller.pl', '313975407', 'F'),
('94', 'Alexandre Clayton', 'Alexandre@Clayton.pl', '726276122', 'M'),
('95', 'Mahamed Morton', 'Mahamed@Morton.pl', '230794397', 'M'),
('96', 'Dillon Baird', 'Dillon@Baird.pl', '984661238', 'F'),
('97', 'Niall Atkins', 'Niall@Atkins.pl', '450573794', 'F'),
('98', 'Timothy Rose', 'Timothy@Rose.pl', '705894429', 'M'),
('99', 'Carla Woodard', 'Carla@Woodard.pl', '1087231012', 'F'),
('100', 'Ruben Meyer', 'Ruben@Meyer.pl', '884639530', 'M');


INSERT INTO `kart_model` (`id`, `model`, `power`, `number_of_seats`) VALUES 
(1,'RiMO EVO6', '13', '1'),
(2,'RiMO ALPHA2', '13', '1'),
(3,'RiMO MiNi', '8.5', '1'),
(4,'RiMO TWiN', '8.5', '2'),
(5,'SODI RX250', '28', '1'),
(6,'SODI 2Drive', '9', '2'),
(7,'SODI RT8', '9', '1'),
(8,'SODI SR5', '6.5', '1'),
(9,'CRG Puffo', '1.3', '1'),
(10,'CRG Junior', '3.5', '1'),
(11,'CRG Centurion', '10', '1'),
(12,'CRG Taxi', '10', '2');

INSERT INTO `kart` (`id`, `kart_number`, `kart_model_id`) VALUES
('1', '1', '1'),
('2', '2', '1'),
('3', '3', '1'),
('4', '4', '1'),
('5', '5', '1'),
('6', '6', '1'),
('7', '7', '1'),
('8', '8', '1'),
('9', '9', '1'),
('10', '10', '1'),
('11', '11', '2'),
('12', '12', '2'),
('13', '13', '2'),
('14', '14', '2'),
('15', '15', '2'),
('16', '16', '2'),
('17', '17', '2'),
('18', '18', '2'),
('19', '19', '2'),
('20', '20', '2'),
('21', '21', '3'),
('22', '22', '3'),
('23', '23', '3'),
('24', '24', '3'),
('25', '25', '3'),
('26', '26', '3'),
('27', '27', '3'),
('28', '28', '3'),
('29', '29', '3'),
('30', '30', '3'),
('31', '31', '4'),
('32', '32', '4'),
('33', '33', '4'),
('34', '34', '4'),
('35', '35', '4'),
('36', '36', '4'),
('37', '37', '4'),
('38', '38', '4'),
('39', '39', '4'),
('40', '40', '4'),
('41', '41', '5'),
('42', '42', '5'),
('43', '43', '5'),
('44', '44', '5'),
('45', '45', '5'),
('46', '46', '5'),
('47', '47', '5'),
('48', '48', '5'),
('49', '49', '5'),
('50', '50', '5'),
('51', '51', '6'),
('52', '52', '6'),
('53', '53', '6'),
('54', '54', '6'),
('55', '55', '6'),
('56', '56', '6'),
('57', '57', '6'),
('58', '58', '6'),
('59', '59', '6'),
('60', '60', '6'),
('61', '61', '7'),
('62', '62', '7'),
('63', '63', '7'),
('64', '64', '7'),
('65', '65', '7'),
('66', '66', '7'),
('67', '67', '7'),
('68', '68', '7'),
('69', '69', '7'),
('70', '70', '7'),
('71', '71', '8'),
('72', '72', '8'),
('73', '73', '8'),
('74', '74', '8'),
('75', '75', '8'),
('76', '76', '8'),
('77', '77', '8'),
('78', '78', '8'),
('79', '79', '8'),
('80', '80', '8'),
('81', '81', '9'),
('82', '82', '9'),
('83', '83', '9'),
('84', '84', '9'),
('85', '85', '9'),
('86', '86', '9'),
('87', '87', '9'),
('88', '88', '9'),
('89', '89', '9'),
('90', '90', '9'),
('91', '91', '10'),
('92', '92', '10'),
('93', '93', '10'),
('94', '94', '10'),
('95', '95', '10'),
('96', '96', '10'),
('97', '97', '10'),
('98', '98', '10'),
('99', '99', '10'),
('100', '100', '10'),
('101', '101', '11'),
('102', '102', '11'),
('103', '103', '11'),
('104', '104', '11'),
('105', '105', '11'),
('106', '106', '11'),
('107', '107', '11'),
('108', '108', '11'),
('109', '109', '11'),
('110', '110', '11'),
('111', '111', '12'),
('112', '112', '12'),
('113', '113', '12'),
('114', '114', '12'),
('115', '115', '12'),
('116', '116', '12'),
('117', '117', '12'),
('118', '118', '12'),
('119', '119', '12'),
('120', '120', '12');

INSERT INTO `track` (`id`, `shape`) VALUES
(1, 'Nonagon'),
(2, 'Octagon'),
(3, 'Heptagon'),
(4, 'Hexagon'),
(5, 'Triangle'),
(6, 'Parallelogram'),
(7, 'Rhombus'),
(8, 'Square'),
(9, 'Pentagon'),
(10, 'Circle'),
(11, 'Oval'),
(12, 'Heart'),
(13, 'Cross'),
(14, 'Arrow'),
(15, 'Cube'),
(16, 'Cylinder'),
(17, 'Star'),
(18, 'Crescent');

